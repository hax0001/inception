server {
    # 1. Listen on port 443 (HTTPS) only
    listen 443 ssl;
    listen [::]:443 ssl;  # IPv6 support (good practice)
    
    server_name nait-bou.42.fr;

    # 2. SSL Certificates
    ssl_certificate /etc/ssl/server.crt;
    ssl_certificate_key /etc/ssl/server.key;
    
    # 3. Protocol Rules (Subject Requirement: TLS 1.2 or 1.3)
    ssl_protocols TLSv1.2 TLSv1.3;

    # 4. Root Directory (Must match the volume shared with WordPress)
    root /var/www/html;
    index index.php index.html index.htm;

    # 5. Main Location Block
    location / {
        # FIX: Redirect to index.php if file not found (Critical for WP)
        try_files $uri $uri/ /index.php?$args;
    }

    # 6. PHP Processing
    location ~ \.php$ {
        try_files $uri =404;
        
        # Connect to the WordPress container
        # "wp-php" is the service name from docker-compose.yml
        # "9000" is the port PHP-FPM listens on
        fastcgi_pass wp-php:9000;
        
        fastcgi_index index.php;
        
        # Standard FastCGI parameters
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    }
}