events {
    # The 'events' block is required in NGINX.
    worker_connections 1024;
}

http {
    # Include default mime types (css, js, images, etc.)
    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    server {
        # 1. Listen on port 443 (HTTPS) only
        listen 443 ssl;
        listen [::]:443 ssl;
        
        server_name nait-bou.42.fr;

        # 2. SSL Certificates
        # These paths MATCH the 'openssl' command in your Dockerfile
        ssl_certificate /etc/ssl/server.crt;
        ssl_certificate_key /etc/ssl/server.key;
        
        # 3. Protocol Rules (Subject Requirement: TLS 1.2 or 1.3)
        ssl_protocols TLSv1.2 TLSv1.3;

        # 4. Root Directory
        root /var/www/html;
        index index.php index.html index.htm;

        # 5. Main Location Block
        location / {
            # Redirect 404s to WordPress index.php (Essential for permalinks)
            try_files $uri $uri/ /index.php?$args;
        }

        # 6. PHP Processing
        location ~ \.php$ {
            try_files $uri =404;
            
            # FASTCGI PASS:
            # We use 'wordpress' (the service name in docker-compose)
            fastcgi_pass wordpress:9000;
            
            fastcgi_index index.php;
            
            include fastcgi_params;
            fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        }
    }
}